from typing import List

"""
================================================================================
ğŸ“˜ é¢˜ç›® æœ€å¤§çŸ©å½¢ (Maximal Rectangle)
#### æµ‹è¯•é“¾æ¥: https://leetcode.cn/problems/maximal-rectangle/
================================================================================
éš¾åº¦ï¼šå›°éš¾
æ ‡ç­¾ï¼šæ ˆ, æ•°ç»„, åŠ¨æ€è§„åˆ’, çŸ©é˜µ, å•è°ƒæ ˆ

ã€é¢˜ç›®æè¿°ã€‘
ç»™å®šä¸€ä¸ªä»…åŒ…å« '0' å’Œ '1' ã€å¤§å°ä¸º rows x cols çš„äºŒç»´äºŒè¿›åˆ¶çŸ©é˜µï¼Œæ‰¾å‡ºåªåŒ…å« '1' çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚

--------------------------------------------------------------------------------
ğŸŒŸ ç¤ºä¾‹ 1:
   (å›¾ç‰‡å±•ç¤ºäº†ä¸€ä¸ª 4x5 çš„çŸ©é˜µ,å…¶ä¸­æœ‰ä¸€å— 2x3 çš„åŒºåŸŸå…¨æ˜¯ 1)
   è¾“å…¥: matrix = [
     ["1","0","1","0","0"],
     ["1","0","1","1","1"],
     ["1","1","1","1","1"],
     ["1","0","0","1","0"]
   ]
   è¾“å‡º: 6
   è§£é‡Š: æœ€å¤§çŸ©å½¢å¦‚ä¸Šå›¾æ‰€ç¤º (ç¬¬2è¡Œåˆ°ç¬¬3è¡Œ,ç¬¬2åˆ—åˆ°ç¬¬4åˆ—).

ğŸŒŸ ç¤ºä¾‹ 2:
   è¾“å…¥: matrix = [["0"]]
   è¾“å‡º: 0

ğŸŒŸ ç¤ºä¾‹ 3:
   è¾“å…¥: matrix = [["1"]]
   è¾“å‡º: 1

--------------------------------------------------------------------------------
ğŸ“ æç¤º (Constraints):
   â€¢ rows == matrix.length
   â€¢ cols == matrix[0].length
   â€¢ 1 <= rows, cols <= 200
   â€¢ matrix[i][j] ä¸º '0' æˆ– '1'
================================================================================
"""

class Solution:
    # âš¡ é¢„åˆ†é…å†…å­˜ï¼Œé¿å…é¢‘ç¹å¼€è¾Ÿç©ºé—´
    heights: list[int] = [0] * 201
    stack: list[int] = [0] * 201
    r = 0

    def maximalRectangle(self, matrix: List[List[str]]) -> int:
        if not matrix: return 0
        n: int = len(matrix)
        m: int = len(matrix[0])
        
        # åˆå§‹åŒ–é«˜åº¦æ•°ç»„
        self.heights = [0] * 201 
        ans: int = 0
        
        # ğŸŸ¢ é€è¡Œéå†,å°†äºŒç»´é—®é¢˜é™ç»´æˆä¸€ç»´ç›´æ–¹å›¾é—®é¢˜
        for i in range(n):
            for j in range(m):
                # ğŸ§± æ›´æ–°é«˜åº¦:é‡ '0' é«˜åº¦å½’é›¶,é‡ '1' åœ¨ä¸Šä¸€è¡Œé«˜åº¦åŸºç¡€ä¸Š +1
                self.heights[j] = 0 if matrix[i][j] == '0' else self.heights[j] + 1
            
            # ğŸ“ è®¡ç®—ä»¥å½“å‰è¡Œä½œä¸ºåº•è¾¹çš„ç›´æ–¹å›¾æœ€å¤§çŸ©å½¢é¢ç§¯
            ans = max(self.largestRectangleArea(m), ans)    
            
        return ans
        
    def largestRectangleArea(self, m: int) -> int:
        self.r = 0 # ğŸ”„ é‡ç½®æ ˆé¡¶æŒ‡é’ˆ
        ans: int = 0
        cur: int = 0
        left: int = 0
        
        # ğŸŸ¢ éå†å½“å‰è¡Œçš„æŸ±çŠ¶å›¾
        for i in range(m):
            # âš¡ ç»´æŠ¤å•è°ƒé€’å¢æ ˆ
            # å½“é‡åˆ°æ¯”æ ˆé¡¶æ›´çŸ®çš„æŸ±å­æ—¶,è¯´æ˜æ ˆé¡¶æŸ±å­çš„ã€å³è¾¹ç•Œã€‘å·²ç¡®å®š (å³ i)
            while self.r > 0 and self.heights[self.stack[self.r-1]] >= self.heights[i]:
                cur = self.stack[self.r-1]
                self.r -= 1
                
                # â¬…ï¸ ç¡®å®šå·¦è¾¹ç•Œ:æ ˆä¸­ä¸‹ä¸€ä¸ªå…ƒç´ å³ä¸ºå·¦è¾¹ç•Œ
                left = -1 if self.r == 0 else self.stack[self.r-1]
                
                # ğŸ§® ç»“ç®—é¢ç§¯:(å³è¾¹ç•Œ - å·¦è¾¹ç•Œ - 1) * é«˜åº¦
                ans = max(ans, (i - left - 1) * self.heights[cur])
            
            # â¡ï¸ å…¥æ ˆï¼šå­˜å‚¨ä¸‹æ ‡
            self.stack[self.r] = i
            self.r += 1
            
        # ğŸ§¹ æ¸…ç®—é˜¶æ®µ:æ ˆä¸­å‰©ä½™å…ƒç´ å³è¾¹æ²¡æœ‰æ›´çŸ®çš„æŸ±å­,å³è¾¹ç•Œè§†ä¸º m
        while self.r > 0:
            cur: int = self.stack[self.r-1]
            self.r -= 1
            left = -1 if self.r == 0 else self.stack[self.r-1]
            ans = max(ans, (m - left - 1) * self.heights[cur])
        
        return ans
    
