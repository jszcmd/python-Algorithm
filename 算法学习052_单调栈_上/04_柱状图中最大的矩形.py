from typing import List

"""
================================================================================
ğŸ“˜ æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢ (Largest Rectangle in Histogram)
#### æµ‹è¯•é“¾æ¥: https://leetcode.cn/problems/largest-rectangle-in-histogram
================================================================================
éš¾åº¦:å›°éš¾
æ ‡ç­¾:æ ˆ, æ•°ç»„, å•è°ƒæ ˆ

ã€é¢˜ç›®æè¿°ã€‘
ç»™å®š n ä¸ªéè´Ÿæ•´æ•°,ç”¨æ¥è¡¨ç¤ºæŸ±çŠ¶å›¾ä¸­å„ä¸ªæŸ±å­çš„é«˜åº¦.æ¯ä¸ªæŸ±å­å½¼æ­¤ç›¸é‚»,ä¸”å®½åº¦ä¸º 1 .
æ±‚åœ¨è¯¥æŸ±çŠ¶å›¾ä¸­,èƒ½å¤Ÿå‹¾å‹’å‡ºæ¥çš„çŸ©å½¢çš„æœ€å¤§é¢ç§¯.

--------------------------------------------------------------------------------
ğŸŒŸ ç¤ºä¾‹ 1:
   (å›¾ç‰‡å±•ç¤ºäº†ä¸€ä¸ªæŸ±çŠ¶å›¾,é«˜åº¦åˆ†åˆ«ä¸º [2,1,5,6,2,3],çº¢è‰²åŒºåŸŸä¸ºæœ€å¤§çŸ©å½¢)
   è¾“å…¥:heights = [2,1,5,6,2,3]
   è¾“å‡º:10
   è§£é‡Š:æœ€å¤§çš„çŸ©å½¢ä¸ºå›¾ä¸­çº¢è‰²åŒºåŸŸ,é¢ç§¯ä¸º 10 (é«˜åº¦ä¸º5,å®½åº¦ä¸º2).

ğŸŒŸ ç¤ºä¾‹ 2:
   (å›¾ç‰‡å±•ç¤ºäº†é«˜åº¦ä¸º [2,4] çš„æŸ±çŠ¶å›¾)
   è¾“å…¥:heights = [2,4]
   è¾“å‡º:4

--------------------------------------------------------------------------------
ğŸ“ æç¤º (Constraints):
   â€¢ 1 <= heights.length <= 10^5
   â€¢ 0 <= heights[i] <= 10^4
================================================================================
"""

class Solution:
    # âš¡ é¢„åˆ†é…å†…å­˜,æ¨¡æ‹Ÿæ ˆ (Stack)
    # æ ˆä¸­å­˜å‚¨çš„æ˜¯ã€ä¸‹æ ‡ã€‘,å¯¹åº”çš„ heights å€¼æ˜¯å•è°ƒé€’å¢çš„
    stack: list[int] = [0] * 100001
    r = 0

    def largestRectangleArea(self, heights: List[int]) -> int:
        n: int = len(heights)
        self.r = 0  # ğŸ”„ é‡ç½®æ ˆé¡¶æŒ‡é’ˆ
        ans: int = 0
        cur: int = 0
        left: int = 0
        
        # ğŸŸ¢ éå†æ¯ä¸ªæŸ±å­
        for i in range(n):
            
            # ğŸ›‘ ç»´æŠ¤å•è°ƒé€’å¢æ ˆ
            # å¦‚æœå½“å‰æŸ±å­ i çš„é«˜åº¦ <= æ ˆé¡¶æŸ±å­çš„é«˜åº¦
            # è¯´æ˜æ ˆé¡¶æŸ±å­é‡åˆ°äº†ã€å³è¾¹ç•Œã€‘(å³ i ),æ— æ³•ç»§ç»­å‘å³å»¶ä¼¸äº†,å¿…é¡»ç»“ç®—
            while self.r > 0 and heights[self.stack[self.r - 1]] >= heights[i]:
                
                # 1ï¸âƒ£ ç¡®å®šé«˜åº¦:å¼¹å‡ºæ ˆé¡¶,ä½œä¸ºçŸ©å½¢çš„é«˜åº¦
                cur = self.stack[self.r - 1]
                self.r -= 1
                
                # 2ï¸âƒ£ ç¡®å®šå·¦è¾¹ç•Œ (left)
                # æ ˆé¡¶å¼¹å‡ºå,æ–°çš„æ ˆé¡¶å°±æ˜¯ cur å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”å®ƒçŸ®çš„å…ƒç´ (å·¦è¾¹ç•Œ)
                # å¦‚æœæ ˆç©ºäº†,è¯´æ˜ cur å·¦è¾¹æ²¡æœ‰æ¯”å®ƒçŸ®çš„,å·¦è¾¹ç•Œå»¶ä¼¸åˆ° -1
                left = -1 if self.r == 0 else self.stack[self.r - 1]
                
                # 3ï¸âƒ£ è®¡ç®—é¢ç§¯å¹¶æ›´æ–°æœ€å¤§å€¼
                # ğŸ“ å®½åº¦è®¡ç®—:(å³è¾¹ç•Œ - å·¦è¾¹ç•Œ - 1)
                # å³è¾¹ç•Œæ˜¯ i (ä¸åŒ…å«),å·¦è¾¹ç•Œæ˜¯ left (ä¸åŒ…å«)
                ans = max(ans, (i - left - 1) * heights[cur])
            
            # â¡ï¸ è¿›æ ˆ:å½“å‰æŸ±å­æ¯”æ ˆé¡¶é«˜(æˆ–æ ˆä¸ºç©º),å…¥æ ˆç­‰å¾…å¯»æ‰¾å³è¾¹ç•Œ
            self.stack[self.r] = i
            self.r += 1
            
        # ğŸŸ¡ æ¸…ç©ºæ ˆ:å¤„ç†æ ˆä¸­å‰©ä½™çš„æŸ±å­
        # è¿™äº›æŸ±å­å³è¾¹æ²¡æœ‰æ¯”å®ƒçŸ®çš„äº†,æ‰€ä»¥å³è¾¹ç•Œä¸€ç›´æ˜¯ n (æ•°ç»„æœ«å°¾)
        while self.r > 0:
            cur: int = self.stack[self.r - 1]
            self.r -= 1
            
            # å·¦è¾¹ç•Œé€»è¾‘åŒä¸Š
            left = -1 if self.r == 0 else self.stack[self.r - 1]
            
            # ğŸ“ å®½åº¦è®¡ç®—:è¿™é‡Œå³è¾¹ç•Œå˜æˆäº† n
            ans = max(ans, (n - left - 1) * heights[cur])
        
        return ans