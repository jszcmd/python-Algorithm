# 🚀 算法讲解030：异或运算的骚操作

> 👨‍🏫 **讲师**：左程云
> 📘 **前置知识**：讲解003 - 二进制和位运算

---

### ⚠️ 特别提醒 (Python 用户)

> Python 的整数处理机制与 Java/C++ 不同，刷题时请务必注意：

* **手动处理溢出**：Python 整数自动扩容，不会自动截断。
* **符号扩展问题**：负数的二进制表示需要手动干预。
* **常用技巧**：使用掩码处理，例如 `(n << shift_amount) & 0xFFFFFFFF`。

---

## 1. 🧠 脑筋急转弯：黑白球问题

### 📝 题目描述
袋子里有 `a` 个白球，`b` 个黑球。每次取出 **2** 个球，规则如下：

1.  取出 **2白** 或 **2黑** $\rightarrow$ 放回 **1白**
2.  取出 **1白** + **1黑** $\rightarrow$ 放回 **1黑**

**问**：直到袋中只剩 1 个球时，这个球是 **黑球** 的概率是多少？

### 🔓 答案与解析
**结论**：这是一个披着概率外衣的 **异或运算** 题目。结果完全 **与白球数量 `a` 无关**。

* 若黑球 `b` 是 **偶数** $\rightarrow$ 黑球概率 **0%**
* 若黑球 `b` 是 **奇数** $\rightarrow$ 黑球概率 **100%**

> **💡 核心原理**
> 把白球看作 `0`，黑球看作 `1`，操作规则等价于 **异或 (XOR)**：
> * `0` $\oplus$ `0` = `0` (同色变白)
> * `1` $\oplus$ `1` = `0` (同色变白)
> * `0` $\oplus$ `1` = `1` (异色变黑)
>
> **本质**：整个过程就是对袋子里所有球求 **异或和**。

---

## 2. 💡 异或运算的核心性质

异或运算（XOR，符号 `^` 或 $\oplus$）即 **无进位相加**。

### 四大定律
1.  **无进位相加**：二进制位对应相加，不产生进位。
2.  **交换律 & 结合律**：顺序不重要，结果只由元素决定。
    * $A \oplus B = B \oplus A$
    * $(A \oplus B) \oplus C = A \oplus (B \oplus C)$
3.  **恒等 & 归零律**：
    * $N \oplus 0 = N$
    * $N \oplus N = 0$
4.  **可逆性 (区间异或)**：
    * 若 `总异或和` = $X$，`局部异或和` = $Y$
    * 则 `剩余部分` = $X \oplus Y$

---

## 3. ⚔️ 常见面试题型 (骚操作)

利用异或性质解决的高频题目：

* [ ] **题目 1**：如何不使用临时变量交换两个数 `Swap(a, b)`
* [ ] **题目 2**：不用比较符号，判断并返回两个数的最大值
* [ ] **题目 3**：数组中缺失的一个数字
* [ ] **题目 4**：数组中只有 **1种数** 出现奇数次，其余出现偶数次，找到它
* [ ] **题目 5**：数组中只有 **2种数** 出现奇数次，其余出现偶数次，找到它们
* [ ] **题目 6**：数组中只有 **1种数** 出现次数 $< m$，其余都出现 $m$ 次

### 🔧 必备技巧：Brian Kernighan 算法
**功能**：提取二进制中最右侧的 `1`
**公式**：
```c
// 取出最右侧的1
rightOne = n & (-n);