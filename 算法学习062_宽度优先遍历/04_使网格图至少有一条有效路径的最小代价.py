from typing import List
from collections import deque

"""
0-1 BFS (åŒç«¯é˜Ÿåˆ—å¹¿åº¦ä¼˜å…ˆæœç´¢) ::: LeetCode 1368
=========================================================================
ğŸš€ ã€ç®—æ³•æ¨¡æ¿ç»ƒä¹ ã€‘ä½¿ç½‘æ ¼å›¾è‡³å°‘æœ‰ä¸€æ¡æœ‰æ•ˆè·¯å¾„çš„æœ€å°ä»£ä»·
#### æµ‹è¯•é“¾æ¥: https://leetcode.cn/problems/minimum-cost-to-make-at-least-one-valid-path-in-a-grid/description/
-------------------------------------------------------------------------
ã€æè¿°ã€‘
ç»™ä½ ä¸€ä¸ª m x n çš„ç½‘æ ¼å›¾ grid . grid ä¸­æ¯ä¸ªæ ¼å­éƒ½æœ‰ä¸€ä¸ªæ•°å­—,å¯¹åº”ç€ä»è¯¥æ ¼å­å‡ºå‘ä¸‹ä¸€æ­¥èµ°çš„æ–¹å‘.
grid[i][j] ä¸­çš„æ•°å­—å¯èƒ½ä¸ºä»¥ä¸‹å‡ ç§æƒ…å†µ:
- 1 :ä¸‹ä¸€æ­¥å¾€å³èµ°ï¼Œä¹Ÿå°±æ˜¯ä½ ä¼šä» grid[i][j] èµ°åˆ° grid[i][j + 1]
- 2 :ä¸‹ä¸€æ­¥å¾€å·¦èµ°ï¼Œä¹Ÿå°±æ˜¯ä½ ä¼šä» grid[i][j] èµ°åˆ° grid[i][j - 1]
- 3 :ä¸‹ä¸€æ­¥å¾€ä¸‹èµ°ï¼Œä¹Ÿå°±æ˜¯ä½ ä¼šä» grid[i][j] èµ°åˆ° grid[i + 1][j]
- 4 :ä¸‹ä¸€æ­¥å¾€ä¸Šèµ°ï¼Œä¹Ÿå°±æ˜¯ä½ ä¼šä» grid[i][j] èµ°åˆ° grid[i - 1][j]

æ³¨æ„ç½‘æ ¼å›¾ä¸­å¯èƒ½ä¼šæœ‰ æ— æ•ˆæ•°å­— ,å› ä¸ºå®ƒä»¬å¯èƒ½æŒ‡å‘ grid ä»¥å¤–çš„åŒºåŸŸ.

ä¸€å¼€å§‹,ä½ ä¼šä»æœ€å·¦ä¸Šè§’çš„æ ¼å­ (0,0) å‡ºå‘.
æˆ‘ä»¬å®šä¹‰ä¸€æ¡ æœ‰æ•ˆè·¯å¾„ ä¸ºä»æ ¼å­ (0,0) å‡ºå‘ï¼Œæ¯ä¸€æ­¥éƒ½é¡ºç€æ•°å­—å¯¹åº”æ–¹å‘èµ°ï¼Œæœ€ç»ˆåœ¨æœ€å³ä¸‹è§’çš„æ ¼å­ (m - 1, n - 1) ç»“æŸçš„è·¯å¾„.
æœ‰æ•ˆè·¯å¾„ ä¸éœ€è¦æ˜¯æœ€çŸ­è·¯å¾„ .

ä½ å¯ä»¥èŠ±è´¹ cost = 1 çš„ä»£ä»·ä¿®æ”¹ä¸€ä¸ªæ ¼å­ä¸­çš„æ•°å­—,ä½†æ¯ä¸ªæ ¼å­ä¸­çš„æ•°å­— åªèƒ½ä¿®æ”¹ä¸€æ¬¡ .

è¯·ä½ è¿”å›è®©ç½‘æ ¼å›¾è‡³å°‘æœ‰ä¸€æ¡æœ‰æ•ˆè·¯å¾„çš„æœ€å°ä»£ä»·.

ã€è¾“å…¥æè¿°ã€‘
grid: äºŒç»´æ•´æ•°æ•°ç»„,è¡¨ç¤ºç½‘æ ¼å›¾,å…¶ä¸­ grid[i][j] ä»£è¡¨è¯¥æ ¼å­çš„æ–¹å‘.
gridSize: æ•´æ•°ï¼Œè¡¨ç¤ºè¡Œæ•° m.
gridColSize: æ•´æ•°æ•°ç»„ï¼Œè¡¨ç¤ºæ¯ä¸€è¡Œçš„åˆ—æ•°.

ã€è¾“å‡ºæè¿°ã€‘
int: è¿”å›è®©ç½‘æ ¼å›¾è‡³å°‘æœ‰ä¸€æ¡æœ‰æ•ˆè·¯å¾„çš„æœ€å°ä»£ä»·.

ã€ç¤ºä¾‹ 1ã€‘
è¾“å…¥: grid = [[1,1,1,1],[2,2,2,2],[1,1,1,1],[2,2,2,2]]
è¾“å‡º: 3
è§£é‡Š: ä½ å°†ä»ç‚¹ (0, 0) å‡ºå‘.
åˆ°è¾¾ (3, 3) çš„è·¯å¾„ä¸º:
(0, 0) --> (0, 1) --> (0, 2) --> (0, 3) èŠ±è´¹ä»£ä»· cost = 1 ä½¿æ–¹å‘å‘ä¸‹ -->
(1, 3) --> (1, 2) --> (1, 1) --> (1, 0) èŠ±è´¹ä»£ä»· cost = 1 ä½¿æ–¹å‘å‘ä¸‹ -->
(2, 0) --> (2, 1) --> (2, 2) --> (2, 3) èŠ±è´¹ä»£ä»· cost = 1 ä½¿æ–¹å‘å‘ä¸‹ -->
(3, 3)
æ€»èŠ±è´¹ä¸º cost = 3.
=========================================================================
"""


class Solution:
    def minCost(self, grid: List[List[int]]) -> int:
        # 0å ä½, 1:å³, 2:å·¦, 3:ä¸‹, 4:ä¸Š (é¢˜ç›®å®šä¹‰çš„å¯¹åº”å…³ç³»)
        move = [[0, 0], [0, 1], [0, -1], [1, 0], [-1, 0]]
        m, n = len(grid), len(grid[0])  # è·å–ç½‘æ ¼è¡Œæ•° m å’Œåˆ—æ•° n
        distance = [[float('inf')] * n for _ in range(m)]  # åˆå§‹åŒ–è·ç¦»è¡¨,é»˜è®¤æ— ç©·å¤§
        queue = deque([(0, 0)])  # åˆå§‹åŒ–åŒç«¯é˜Ÿåˆ—,èµ·ç‚¹å…¥é˜Ÿ
        distance[0][0] = 0  # èµ·ç‚¹ä»£ä»·åˆå§‹åŒ–ä¸º 0

        while queue:  # å½“é˜Ÿåˆ—ä¸ä¸ºç©ºæ—¶å¾ªç¯
            x, y = queue.popleft()  # å–å‡ºé˜Ÿå¤´èŠ‚ç‚¹
            if x == m - 1 and y == n - 1:  # å¦‚æœåˆ°è¾¾å³ä¸‹è§’ç»ˆç‚¹
                return int(distance[x][y])  # ç›´æ¥è¿”å›æœ€å°ä»£ä»·

            for i in range(1, 5):  # éå† 1~4 å››ä¸ªæ–¹å‘
                nx, ny = x + move[i][0], y + move[i][1]  # è®¡ç®—é‚»å±…åæ ‡
                weight = 0 if grid[x][y] == i else 1  # é¡ºè·¯ä»£ä»·0, æ”¹è·¯ä»£ä»·1

                # è¾¹ç•Œæ£€æŸ¥ + æ¾å¼›æ“ä½œ (è·ç¦»å˜å°æ‰å¤„ç†)
                if 0 <= nx < m and 0 <= ny < n and distance[x][y] + weight < distance[nx][ny]:
                    distance[nx][ny] = distance[x][y] + weight  # æ›´æ–°æœ€çŸ­è·ç¦»
                    if weight == 0:  # å¦‚æœä»£ä»·æ˜¯ 0 (é¡ºè·¯)
                        queue.appendleft((nx, ny))  # æ’é˜Ÿåˆ°é˜Ÿå¤´ (VIPé€šé“,ä¼˜å…ˆå¤„ç†)
                    else:  # å¦‚æœä»£ä»·æ˜¯ 1 (æ”¹è·¯)
                        queue.append((nx, ny))  # æ’é˜Ÿåˆ°é˜Ÿå°¾ (æ™®é€šé€šé“)
        return -1  # é¢˜ç›®ä¿è¯æœ‰è§£,æ˜¯ä¸å¯èƒ½è¿”å›-1çš„
